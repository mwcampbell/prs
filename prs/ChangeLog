2002-11-16  Matt Campbell  <mattcampbell@pobox.com>

	* configure.in src/db.c src/db.h: Quit using mysql_config, because
	that utility isn't present in slightly older versions of MySQL,
	but mysql.h is in the same location on both Red Hat and Debian, so
	it doesn't really matter.

	* Switched to MySQL (version 3.23.x).

	* src/mp3decoder.c (mp3_decoder_destroy): This function now kills
	the decoder process in addition to closing the pipe.

2002-11-15  Marc Mulcahy  <marc@plbb.net>

	* src/prs_config.c (multiband_audio_compressor_config): Ensured that
	the frequencies for the bands of the multiband compressor can't be
	mis-configured.
	
	* src/multibandaudiocompressor.c
	(multiband_audio_compressor_process_data): Added declipper to the
	filter stages.
	
2002-11-11  Marc Mulcahy  <marc@plbb.net>

	* src/mixerautomation.c (mixer_automation_destroy): Kill automation
	thread when automation object is destroyed rather than joining it.

	* src/scheduler.c (scheduler_destroy): Kill scheduler thread when
	scheduler object is destroyed rather than joining it.

2002-11-10  Matt Campbell  <mattcampbell@pobox.com>

	* src/prs_config.c src/prs_server.c: The configuration file to be
	used can now be specified as a command-line argument.  If no
	argument is given, prs.conf is still the default.

	* src/prs.conf: Replaced Marc's stream details with more generic
	place-holder values.

	* Added a telnet interface so that PRS can be detached from the
	terminal on which it was started but still be controlled if
	desired.

2002-11-10  Marc Mulcahy  <marc@plbb.net>

	* src/mixerpatchpoint.c (mixer_patch_point_post_data): Fixed
	mono/stereo resampling bug.
	
2002-11-10  Marc Mulcahy  <marc@plbb.net>

	* Removed src/global_data.c and src/global_data.h.

	* Added src/soundcard.c and src/soundcard.h for storing and retrieving
	parameters about the currently open soundcard.

	* src/ossmixerchannel.c src/ossmixeroutput.c: Modified to use new
	soundcard.c functions.

	* src/Makefile.am: removed references to global_data.c and
	global_data.h.  added soundcard.c to the list of sources for
	prs_server.  added fileinfo.c vorbisfileinfo.c and mp3fieinfo.c to the
	list of sources for prs_server.
	
	* src/mixer.c src/mixer.h (mixer_enable_channel)
	(mixer_enable_output): Added functions for enabling and disabling
	channels and outputs.  these are thread-safe and better than
	maniuplating the MixerChannel and MixerOutput data structures directly.
		
	* src/mixerautomation.c (mixer_automation_log_event): Add entry to log
	only if the recording can be found in the database.
	
	* src/multibandaudiocompressor.c
	(multiband_audio_compressor_process_data): Fixed bug in handling
	mono audio.
	
	* src/prs_config.c (mixer_channel_config): Added ability to add
	channels to the mixer in the config file.  Currently ohnly works for
	oss channels.
	
	* src/prs.conf: Added oss mixer channel configuration to configuration file.
	
	* src/prs_server.c (load_playlist): Added simple playlist loader.
	
	* src/shoutmixeroutput.c (start_encoder): Fixed spawning of mp3 encode
	for mono streams with mono buses.
	
2002-11-10  Matt Campbell  <mattcampbell@pobox.com>

	* src/fileinfo.h src/mp3fileinfo.c src/mp3fileinfo.h
	src/prs_db_builder.c src/vorbisfileinfo.c src/vorbisfileinfo.h:
	There are now two threshholds, one for audio_in and the other for
	audio_out.

	* src/mixerpatchpoint.c: Fixed resampling code so it correctly
	handles the case when the channel is mono and the bus is stereo.

2002-11-09  Marc Mulcahy <marc@plbb.net>

	* Checked in initial resampling support.

2002-11-04  Marc Mulcahy <marc@plbb.net>

	* src/mixerautomation.c: Folded loggin back in.

2002-11-04  Matt Campbell  <mattcampbell@pobox.com>

	* src/mp3tech.c: Made variables static to avoid naming conflict.

2002-11-02  Matt Campbell  <mattcampbell@pobox.com>

	* src/db.c: The username is now quoted when a grant operation is
	done.  This is necessary because the username for the Web server
	under Debian is www-data, which must be in quotes in PostgreSQL.

	* src/prs_db_builder.c: The database builder now accepts up to
	three command line arguments:  the root directory of the audio
	files, the username under which the Web server runs, and
	optionally the category in which all imported files should be
	placed.

	* Added MP3 input, using mpg123 for decoding and the mp3tech.c
	file from the mp3info file for parsing the ID3 tags and MP3
	header.

2002-10-24  Marc Mulcahy <marc@plbb.net>

	* src/prs_server.c src/shoutmixeroutput.c: Added support for
	stereo/mono encoding.  added support for both Vorbis and mp3 encoding.
	
	* src/prs_config.c: Added XML configuration file rather than databse
	table.

2002-10-08  Marc Mulcahy <marc@plbb.net>

	*  src/mixerbus.c: Added declipper to the mixer.

2002-10-08  Marc Mulcahy <marc@plbb.net>

	* src/prs_server.c: Updated CVS to reflect what's on the air on Big
	Planet.

2002-08-22  Marc Mulcahy <marc@plbb.net>

	* src/multibandaudiocompressor.c src/multibandaudiocompressor.h:
	Initial implementation of multiband compressor.

2002-08-12  Marc Mulcahy <marc@plbb.net>

	* src/audiocompressor.c src/audiocompressor.h: Automatically compute
	output gain.

2002-08-11  Marc Mulcahy <marc@plbb.net>

	* src/audiocompressor.c: Fixed audio compressor again.

	* src/scheduler.c: Fixed template change bug in scheduler.

2002-08-10  Marc Mulcahy <marc@plbb.net>

	* src/audiocompressor.c src/prs_server.c: Fixed audio compressor.

2002-08-09  Marc Mulcahy <marc@plbb.net>

	* src/audiofilter.c src/audiofilter.h src/Makefileam:
	Added AudioFilter object.

2002-08-03  Marc Mulcahy <marc@plbb.net>

	* src/db.c src/db.h src/mixerautomation.c: Added logging.

2002-08-03  Marc Mulcahy <marc@plbb.net>

	* src/scheduler.c src/scheduler.h: made scheduler thread-safe.

2002-08-03  Marc Mulcahy <marc@plbb.net>

	* src/mixerautomation.c: Made thread-safe.

2002-08-03  Marc Mulcay <marc@plbb.net>

	* src/global_data.c src/global_data.h src/ossmixerchannel.c
	src/ossmixerchannel.c: better handling for full and half duplex
	sound cards.

	* src/scheduler.c src/scheduler.h src/prs_server.c: added new
	scheduler.

202-08-02  Marc Mulcahy <marc@plbb.net>

	* src/prs_server.c: Made recording selection failures work as
	0-length events.

2002-08-02  Marc Mulcahy <marc2plbb.net>

	* src/mixerautomation.c src/mixerautomation.h src/mixer.c src/mixer.h:
	Implemented new automation system.  Events were removed from the mixer
	and moved to an external Mixerautomation object.  This required
	changing the mixer to now allow the client to specify a time
	to be notified.

2002-08-01  Marc Mulcahy <marc@plbb.net>

	* src/shoutmixeroutput.c: Disable output if connection to server fails.

2002-08-01  Marc Mulcahy <marc@plbb.net>

	* src/mixerautomation.c src/mixerautomation.h: Started work on new
	automation system.

2002-07-29  Marc Mulcahy <marc@plbb.net>

	* src/prs_server.c: Fixed end of template bug.

2002-07-29  Marc Mulcahy <marc@plbb.net>

	* src/ db.c src/prs_server.c: Delete debug fprintf statements.

2002-07-29  Marc Mulcahy <marc@plbb.net>

	* src/mixer.c: Made mixer_fade_channel_fade fail if a fade is
	currently in progress.  This allows mixer_fade_ll to take precidence.

	* src/mixer.c src/db.c: Converted all internal time systems to use
	standard Unix time format stored in doubles to allow less than one
	second mixer timing accuracy.  This gets rid of the whole slew of bugs
	where the mixer crashes on day switch.

2002-07-29  Marc Mulcahy <marc@plbb.net>

	* src/db.c: made template start times inclusive and template end times
	non inclusive so overlapping templates don't result in problems.

2002-07-22  Marc Mulcahy <marc@plbb.net>
	
	* src/prs_server.c: Added a signal handler for SIGUSR1.  Added
	support for re-configuring the shoutcast stream based on the
	config database.

	* src/shoutmixeroutput.c: Added shout_conn_t_free for freeing
	shout_conn_t structures with dynamically allocated strings in
	them.  Abstracted out the code for starting and stopping the
	encoder, so the stream can be dynamically re-configured.  Made the
	shout_thread function static.  Changed the signature of the
	shout_mixer_output_new function to take the output name, the rate,
	the number of channels, and a pointer to a shout_conn_t structure.
	Added a function called shout_mixer_output_get_connection to
	return the shout_conn_t structure.  added a
	shout_mixer_output_set_connection to reset the shout connection--
	has smarts to only restart the stream when critical parameters
	like ip or port chang, restarts encoder when bitrate changes.

	* src/mixer.c src/mixer.h: Renamed mixer_find_channel to
	mixer_get_channel and mixer_find_output to mixer_get_output.
	Exported those two functions.  Added mixer_delete_channel and
	mixer_delete_output.

	* src/db.c src/db.h: Added support for configuration and status
	tables.

	* src/mixer.c: Fixed mixer_stop so it actually works.  Made
	mixer_destroy use mixer_stop before destroying the channels and
	outputs and the mixer itself.

	* src/mixeroutput.c: Fixed mixer_channel_destroy to pass the
	output to the virtual method mixer_channel_free_data rather than
	just the data.

	* src/ossmixeroutput.c: Protect mixer_output_free_data from NULL
	MixerOutput pointer.
	
2002-07-20  Marc Mulcahy <marc@plbb.net>

	* src/db.c: Added debug message to recording_picker_select to
	indicate when recording selection fails.

2002-07-19  Marc Mulcahy <marc@plbb.net>

	* src/db.c: Added the following fields to the playlist_event
	   database table: event_name - so events can be referenced by
	   other events event_level - so events can contain audio level
	   information event_anchor_event_number - the event to which this
	   event is attached (anchored) event_anchor_position - 0 to
	   anchor to the beginning of the specified event, 1 to anchor to
	   the end.  event_offset - time offset from anchor position
	
	* src/db.h: Added level, anchor_event_number, and achor_position
	fields corresponding to the new columns in the playlist_event
	table.  Added a start_time and end_time field so the last start
	and end time of an event can be stored with the copy of the event
	in the playlist template.

	* src/db.c src/db.h: Added the list of events to the template data
	structure.  Made get_playlist_events_from_template static since it
	is no longer needed externally-- also changed it's signature to
	take a template_id rather than the entire template data structure
	for efficiency.  Made playlist_event_list_free static since it is
	no longer needed externally.  Added a function called
	playlist_template+get+event, which takes a playlist_template and
	an event number.

	* src/db.c: Made recording_picker_new use two standard table names
	(recording_exclude, artist_exclude) so that they can easily be
	referenced by other parts of the app/web interface.

	* src/db.h: Changed event type name to EVENT_TYPE_FADE.

	* src/list.c src/list.h: Added list_get_item.

	* src/mixer.c: Added support for MIXER_EVENT_TYPE_FADE_CHANNEL
	events.

2002-07-14 Marc Mulcahy <marc@plbb.net>

	* src/vorbismixerchannel.c: Get rid of warnings.

	* src/prs_server.c: Included unistd.h to make usleep work.  Cleared
	mixer event structure before posting it to the mixer.  Ensured that
	the end time of the last event is remembered.  Ensure that the
	audio_in is factered into the start time of mixer events.  Added
	processing for playing audio from a specific path.  Added cur_time
	parameter to execute_playlist_template.
			
	* src/mixeroutput.h: Changed mixer latency to .01 seconds.

	* src/mixeroutput.c src/ossmixeroutput.c: Fixed warnings.

	* src/mixerchannel.c: Fixed pointer arithmetic.

	* src/mixer.c src/mixer.h: re-factered mutex code and made two static
	functions called mixer_lock and mixer_unlock, so now all functions
	needing to lock and unlock the mutex use these functions to do so.
	Changed references to a variable named time to cur_time to avoid conflicts with time.h.
	
	* src/list.c: Actually returned the computed length of the list
	(which is nice since the name of the function is list_length).

	* src/mixerevent.h: Changed tim to start_time and added an end_time
	field to support fades.

	* prs_server.c: Re-factored playlist generation to support fades and
	events which aren't sequential

2002-07-13  Marc Mulcahy <marc@plbb.net>

	* src/mixerchannel.h src/vorbismixerchannel.c src/mixer.c: Added an
	enabled flag so mixer channels can be enabled and disabled (in the
	case of files this means paused and unpaused.

2002-07-12  Marc Mulcahy <marc@plbb.net>

	* src/fileinfo.c: Fixed rounding errors in finding audio out queue points.

2002-07-12  Marc Mulcahy <marc@plbb.net>

	* src/mixerchannel.c src/mixerchannel.h src/vorbismixerchannel.c
	src/mixer.c src/mixer.h: Added mixer channel level and fading support.
	Added an end of data flag so we can appropriately dispose of dead
	channels.

2002-07-09  Marc Mulcahy <marc@plbb.net

	* prs_db_builder.c: An entry in the database is now updated when the
	name, genre or length changes in the corresponding audio file.

2002-07-09  Marc Mulcahy <marc@plbb.net>

	* src/db.c src/prs_db_builder.c: Fixed stupidity when handling
	recordings not being in the database on database rebuild.

2002-07-09  Marc Mulcahy <marc@plbb.net>

	* src/db.c src/db.h: Added functions to check for the existence of the
	various database tables.

	* src/db.c src/db.h: Consolidated the functions for creating the two
	playlist-related tables into 1 function.

	* src/db.c src/db.h src/prs_db_builder.c src/prs_server.c: Removed the
	Info naming convention for data structure relating to database stuff
	for convenience.

	* fileinfo.c: Now if you pass 0 as the threshhold value, the
	get_vorbis_file_info function doesn't try to find the audio_in and
	audio_out values which is presumably the most time consuming part of
	building the database.

	* src/db.c src/db.h: Added functions for deleting recordings from the
	database and finding recordings by path.

	* src/prs_db_builder.c: Only updates entries in the database which
	have file lengths which have changed.
		
2002-06-02  Marc Mulcahy <marc@plbb.net>

	* Initial coding begins.
